{"version":3,"file":"pages/my/index.js","sources":["webpack:///./src/pages/my/index.tsx","webpack:///./src/pages/my/components/Photo.scss","webpack:///./src/pages/my/components/Phtot.tsx","webpack:///./src/pages/my/index.scss","webpack:///./src/pages/my/index.tsx?3add"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport Taro, { useDidShow, useDidHide } from '@tarojs/taro'\nimport { useObserver } from 'mobx-react'\nimport { View, Text, Input, Button } from '@tarojs/components'\nimport Photo from './components/Phtot'\nimport store from '../../store/index'\nimport { Toast } from '../../utils/tool'\nimport { getUserInfo, updateUserName } from '../../service/apiModules/user'\nimport '../../../config.ts'\nimport './index.scss'\n\nconst My: React.FC = () => {\n  const { User } = store\n  const [touchStartTime, setTouchStartTime] = useState<number>(0)\n  const [isShowUserName, setShowUserName] = useState<boolean>(false)\n  const [userName, setUserName] = useState<string>('')\n\n  useDidShow(() => {\n    getUserInfoFn()\n    Taro.setNavigationBarTitle({\n      title: '个人中心'\n    })\n  })\n\n  useDidHide(() => {\n    setShowUserName(false)\n  })\n\n  async function getUserInfoFn() {\n    const result = await getUserInfo()\n    if (result.data.status === 200) {\n      User.setuserInfo(result.data.data)\n      setUserName(result.data.data.codeName)\n    }\n  }\n\n  // 上传头像调用接口\n  async function upload(imgList = []) {\n    //小程序\n    if (process.env.TARO_ENV === 'weapp') {\n      Taro.showLoading({\n        title: '正在加载',\n        mask: true\n      })\n      Taro.uploadFile({\n        url: `${(global as any).constants.website}/api/updateUserPhoto`, //仅为示例，非真实的接口地址\n        filePath: (imgList[0] as any).url,\n        name: 'file',\n        formData: {},\n        header: { 'content-type': 'multipart/form-data', 'authority': Taro.getStorageSync('authority') },\n        success(res) {\n          const data = JSON.parse(res.data)\n          if (data.code === 200) {\n            const userInfo = User.userInfo\n            userInfo.photo = data.url\n            User.setuserInfo(userInfo)\n            Toast('更新成功', 'success', 1000)\n          } else {\n            Toast('更新失败', 'none', 1000)\n          }\n          Taro.hideLoading()\n        }\n      })\n    }\n  }\n\n  // 修改头像\n  async function uploadImg(e) {\n    if (process.env.TARO_ENV === 'weapp') {\n      Taro.chooseImage({\n        count: 1,   // 可选图片数量, 这里限制为1张\n        sizeType: ['original', 'compressed'], // 可以指定是原图还是缩图，默认二者都有\n        sourceType: ['album', 'camera'],  // 可以指定来源是相机还是相册，默认二者\n        success(res) {\n          const files: any = [];\n          // 以下几行代码是为了处理成自己想要的格式[{file: {path: '', size: ''}, url: '' }]\n          const obj: any = {};\n          obj.file = res.tempFiles[0];\n          obj.url = res.tempFilePaths[0];\n          files.push(obj);\n          upload(files)\n        }\n      })\n    }\n  }\n\n  // 修改用户名\n  async function updateName() {\n    const result = await updateUserName({ userName })\n    if (result.data.code === 200) {\n      getUserInfoFn()\n      setShowUserName(false)\n      Toast('修改成功', 'success', 1000)\n    } else {\n      Toast('修改失败', 'none', 1000)\n    }\n  }\n\n  // 退出登陆\n  function exitLogin() {\n    Toast('正在退出', 'loading', 1000)\n    User.loginOut()\n    setTimeout(() => {\n      Taro.navigateTo({\n        url: '/pages/notauthority/index'\n      })\n    }, 600)\n  }\n\n  function clickToEmptyPage(name) {\n    Taro.navigateTo({\n      url: `/pages/my/${name}/index`\n    })\n  }\n\n  // 双击显示编辑名字\n  function touchStart(e) {\n    let timer: any = null;\n    if (!touchStartTime) {\n      setTouchStartTime(e.timeStamp)\n      timer = setTimeout(() => {\n        setTouchStartTime(0)\n        clearTimeout(timer);\n      }, 500)\n    } else {\n      if (e.timeStamp - touchStartTime < 350) {\n        setTouchStartTime(0)\n        setShowUserName(true)\n        clearTimeout(timer);\n      }\n    }\n  }\n\n  return useObserver(() => (\n    <View className='container'>\n      <View className='nav'>\n        <View className='photo'>\n          <Photo photoUrl={User.userInfo.photo} uploadImg={uploadImg.bind(this)} />\n        </View>\n        <View className='info' onTouchStart={(e) => { touchStart(e) }}>\n          {\n            isShowUserName ?\n              <View className='changeInfo'><Input focus value={userName} onInput={(e) => { setUserName(e.detail.value) }} /> <Text className=\"btn\" onClick={() => { updateName() }}>OK</Text></View>\n              : <Text>{userName}</Text>\n          }\n        </View>\n      </View>\n      <View className='content'>\n        <Text className='lebalItem' onClick={() => { clickToEmptyPage('about') }}>关于我们</Text>\n        <Text className='lebalItem' onClick={() => { exitLogin() }}>退出登陆</Text>\n      </View>\n      {/* <CoverView className='play' >\n                <CoverImage className='img' src='../../assets/image/newyear.png' />\n            </CoverView> */}\n    </View>\n  ))\n}\nexport default My","// extracted by mini-css-extract-plugin","import React from 'react'\nimport { useObserver } from 'mobx-react'\nimport { View, Image } from \"@tarojs/components\"\nimport \"./Photo.scss\"\n\nexport default function Phtot(props) {\n    return useObserver(() => (\n        <View className='userinfo-img-view portrait flex-box jc-sb ai-ce' data-flag='portrait'>\n            <Image src={props.photoUrl} className='userinfo-img' onClick={(e) => { props.uploadImg(e) }} mode='aspectFill'></Image>\n        </View>\n    ))\n}\n","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/my/index', {}, config || {}))\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AACA;AACA;AADA;AAFA;AAOA;AACA;AADA;AACA;AAdA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAiBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAjBA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AA0BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AAjBA;AAmBA;AACA;AA3BA;AAAA;AAAA;AAAA;AAAA;AAAA;AA1BA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAwDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAcA;AACA;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAxDA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AA4EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAFA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AA5EA;AAAA;AAAA;AACA;AAuFA;AACA;AACA;AACA;AACA;AACA;AADA;AADA;AAKA;AACA;AACA;AACA;AACA;AADA;AAnGA;AACA;AACA;AAuGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAhBA;AA1HA;AACA;AAiJA;;;;;;;;;;;;AC7JA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAKA;;;;;;;;;;;ACXA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}